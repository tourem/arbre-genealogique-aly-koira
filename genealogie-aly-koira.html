<!DOCTYPE html>
<html lang="fr" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>G√©n√©alogie ALY KO√èRA</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        /* LIGHT THEME */
        :root, [data-theme="light"] {
            --bg-primary: #f8fafc;
            --bg-secondary: #ffffff;
            --bg-tertiary: #f1f5f9;
            --bg-hover: #e2e8f0;
            --bg-active: #f0fdf4;
            --text-primary: #0f172a;
            --text-secondary: #475569;
            --text-muted: #94a3b8;
            --text-inverse: #ffffff;
            --border: #e2e8f0;
            --border-light: #f1f5f9;
            --accent: #22c55e;
            --accent-light: #dcfce7;
            --accent-dark: #16a34a;
            --accent-gradient: linear-gradient(135deg, #22c55e, #16a34a);
            --male: #3b82f6;
            --male-bg: rgba(59, 130, 246, 0.1);
            --female: #ec4899;
            --female-bg: rgba(236, 72, 153, 0.1);
            --warning: #f59e0b;
            --warning-gradient: linear-gradient(135deg, #f59e0b, #ea580c);
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
            --tree-line: #cbd5e1;
            --modal-overlay: rgba(15, 23, 42, 0.5);
        }

        /* DARK THEME */
        [data-theme="dark"] {
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-tertiary: #334155;
            --bg-hover: #475569;
            --bg-active: #1a3a2a;
            --text-primary: #f1f5f9;
            --text-secondary: #cbd5e1;
            --text-muted: #64748b;
            --text-inverse: #0f172a;
            --border: #334155;
            --border-light: #1e293b;
            --accent: #4ade80;
            --accent-light: #1a3a2a;
            --accent-dark: #22c55e;
            --accent-gradient: linear-gradient(135deg, #4ade80, #22c55e);
            --male: #60a5fa;
            --male-bg: rgba(96, 165, 250, 0.2);
            --female: #f472b6;
            --female-bg: rgba(244, 114, 182, 0.2);
            --warning: #fbbf24;
            --warning-gradient: linear-gradient(135deg, #fbbf24, #f59e0b);
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.3);
            --shadow: 0 1px 3px 0 rgb(0 0 0 / 0.4), 0 1px 2px -1px rgb(0 0 0 / 0.4);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.4), 0 2px 4px -2px rgb(0 0 0 / 0.4);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.4), 0 4px 6px -4px rgb(0 0 0 / 0.4);
            --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.5), 0 8px 10px -6px rgb(0 0 0 / 0.5);
            --tree-line: #475569;
            --modal-overlay: rgba(0, 0, 0, 0.7);
        }

        body {
            font-family: 'Plus Jakarta Sans', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .app-container { display: flex; min-height: 100vh; }

        /* SIDEBAR */
        .sidebar {
            width: 260px;
            background: var(--bg-secondary);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            position: fixed;
            height: 100vh;
            z-index: 100;
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }

        .logo { padding: 1.25rem 1.5rem; border-bottom: 1px solid var(--border-light); }
        .logo-main { display: flex; align-items: center; gap: 0.75rem; }
        .logo-icon {
            width: 42px; height: 42px;
            background: var(--accent-gradient);
            border-radius: 12px;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.25rem;
            box-shadow: 0 4px 12px rgba(34, 197, 94, 0.3);
        }
        .logo-text { font-weight: 700; font-size: 1.1rem; color: var(--text-primary); }
        .logo-subtitle { font-size: 0.7rem; color: var(--text-muted); font-weight: 500; letter-spacing: 0.5px; text-transform: uppercase; }

        .nav-menu { padding: 1rem 0.75rem; flex: 1; overflow-y: auto; }
        .nav-section-title { font-size: 0.65rem; font-weight: 600; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1px; padding: 0.75rem 0.75rem 0.5rem; }

        .nav-item {
            display: flex; align-items: center; gap: 0.75rem;
            padding: 0.7rem 0.75rem; border-radius: 10px;
            color: var(--text-secondary); font-size: 0.9rem; font-weight: 500;
            cursor: pointer; transition: all 0.2s ease;
            margin-bottom: 2px; border: none; background: none; width: 100%; text-align: left;
        }
        .nav-item:hover { background: var(--bg-tertiary); color: var(--text-primary); }
        .nav-item.active { background: var(--bg-active); color: var(--accent); }
        .nav-icon { width: 20px; height: 20px; opacity: 0.7; }
        .nav-item.active .nav-icon { opacity: 1; }

        /* THEME TOGGLE */
        .theme-toggle {
            margin: 0.5rem 0.75rem;
            padding: 0.5rem;
            background: var(--bg-tertiary);
            border-radius: 10px;
            display: flex;
            gap: 0.25rem;
        }
        .theme-btn {
            flex: 1;
            padding: 0.5rem;
            border: none;
            background: transparent;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.8rem;
            color: var(--text-muted);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.4rem;
            transition: all 0.2s ease;
        }
        .theme-btn.active {
            background: var(--bg-secondary);
            color: var(--text-primary);
            box-shadow: var(--shadow-sm);
        }
        .theme-btn:hover:not(.active) { color: var(--text-primary); }

        .sidebar-footer { padding: 1rem 1.25rem; border-top: 1px solid var(--border-light); }
        .family-badge {
            display: flex; align-items: center; gap: 0.75rem;
            padding: 0.75rem; background: var(--bg-tertiary); border-radius: 10px;
        }
        .family-avatar {
            width: 36px; height: 36px;
            background: var(--warning-gradient);
            border-radius: 8px;
            display: flex; align-items: center; justify-content: center;
            font-size: 0.9rem;
        }
        .family-name { font-weight: 600; font-size: 0.8rem; color: var(--text-primary); }
        .family-count { font-size: 0.7rem; color: var(--text-muted); }

        /* MAIN */
        .main-content { flex: 1; margin-left: 260px; display: flex; flex-direction: column; }

        .topbar {
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border);
            padding: 1rem 2rem;
            display: flex; align-items: center; justify-content: space-between;
            position: sticky; top: 0; z-index: 50;
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }
        .page-title { font-size: 1.25rem; font-weight: 700; color: var(--text-primary); }
        .page-subtitle { font-size: 0.8rem; color: var(--text-muted); margin-top: 2px; }

        .content-area { padding: 1.5rem 2rem; flex: 1; }
        .section { display: none; }
        .section.active { display: block; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }

        /* BUTTONS */
        .btn {
            display: inline-flex; align-items: center; gap: 0.5rem;
            padding: 0.6rem 1rem; font-family: inherit; font-size: 0.85rem; font-weight: 500;
            border-radius: 8px; cursor: pointer; transition: all 0.2s ease;
            border: 1px solid var(--border); background: var(--bg-secondary); color: var(--text-primary);
        }
        .btn:hover { background: var(--bg-tertiary); border-color: var(--border); }
        .btn-primary {
            background: var(--accent-gradient); color: var(--text-inverse); border: none;
            box-shadow: 0 2px 8px rgba(34, 197, 94, 0.3);
        }
        .btn-primary:hover { transform: translateY(-1px); box-shadow: 0 4px 12px rgba(34, 197, 94, 0.4); }
        .btn-sm { padding: 0.4rem 0.75rem; font-size: 0.8rem; }
        .btn-icon { width: 36px; height: 36px; padding: 0; justify-content: center; }

        /* CARDS */
        .card {
            background: var(--bg-secondary); border-radius: 16px;
            box-shadow: var(--shadow); overflow: hidden;
            transition: background-color 0.3s ease;
        }
        .card-header {
            padding: 1.25rem 1.5rem; border-bottom: 1px solid var(--border-light);
            display: flex; align-items: center; justify-content: space-between;
        }
        .card-title { font-size: 0.95rem; font-weight: 600; color: var(--text-primary); }
        .card-body { padding: 1.5rem; }

        /* TREE */
        .tree-toolbar { display: flex; gap: 0.75rem; flex-wrap: wrap; align-items: center; }
        .select-modern {
            appearance: none;
            padding: 0.6rem 2.5rem 0.6rem 1rem;
            font-family: inherit; font-size: 0.85rem;
            border: 1px solid var(--border); border-radius: 8px;
            background: var(--bg-secondary) url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%2394a3b8' viewBox='0 0 16 16'%3E%3Cpath d='M8 11L3 6h10l-5 5z'/%3E%3C/svg%3E") no-repeat right 0.75rem center;
            cursor: pointer; min-width: 200px; color: var(--text-primary);
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }
        .select-modern:focus { outline: none; border-color: var(--accent); box-shadow: 0 0 0 3px var(--accent-light); }

        .tree-canvas {
            background: var(--bg-tertiary);
            border-radius: 12px; margin-top: 1rem;
            min-height: 500px; max-height: 65vh;
            overflow: auto; border: 1px solid var(--border);
            position: relative;
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }
        .tree-container {
            padding: 2rem;
            display: flex; flex-direction: column; align-items: center;
            position: relative; z-index: 1;
            transform-origin: top center; transition: transform 0.2s ease;
        }

        /* TREE NODES */
        .tree-node { display: flex; flex-direction: column; align-items: center; position: relative; }
        .node-card {
            background: var(--bg-secondary);
            border: 2px solid var(--border); border-radius: 14px;
            padding: 0.875rem 1rem; text-align: center;
            cursor: pointer; transition: all 0.25s ease;
            min-width: 130px; max-width: 160px;
            position: relative; z-index: 2; box-shadow: var(--shadow);
        }
        .node-card:hover { transform: translateY(-4px); box-shadow: var(--shadow-lg); border-color: var(--accent); }
        .node-card.selected { border-color: var(--accent); box-shadow: 0 0 0 3px var(--accent-light), var(--shadow-lg); }
        .node-card.root {
            background: var(--accent-gradient); border: none; color: var(--text-inverse);
            box-shadow: 0 8px 20px rgba(34, 197, 94, 0.35);
        }
        .node-avatar {
            width: 44px; height: 44px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            margin: 0 auto 0.5rem; font-size: 1.25rem;
        }
        .node-card.male .node-avatar { background: var(--male-bg); }
        .node-card.female .node-avatar { background: var(--female-bg); }
        .node-card.root .node-avatar { background: rgba(255, 255, 255, 0.2); }
        .node-name { font-size: 0.8rem; font-weight: 600; color: var(--text-primary); line-height: 1.3; }
        .node-card.root .node-name { color: var(--text-inverse); }
        .node-alias { font-size: 0.7rem; color: var(--text-muted); margin-top: 2px; }
        .node-card.root .node-alias { color: rgba(255,255,255,0.8); }
        .node-badge {
            position: absolute; top: -6px; right: -6px;
            width: 20px; height: 20px;
            background: var(--accent); color: white;
            border-radius: 50%; font-size: 0.65rem; font-weight: 600;
            display: flex; align-items: center; justify-content: center;
            border: 2px solid var(--bg-secondary);
        }
        .node-toggle {
            position: absolute; bottom: -12px; left: 50%; transform: translateX(-50%);
            width: 24px; height: 24px;
            background: var(--bg-secondary); border: 2px solid var(--border);
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; font-size: 0.8rem; color: var(--text-muted);
            z-index: 3; transition: all 0.2s ease; box-shadow: var(--shadow-sm);
        }
        .node-toggle:hover { background: var(--accent); border-color: var(--accent); color: white; transform: translateX(-50%) scale(1.1); }

        .tree-children {
            display: flex; justify-content: center; gap: 12px;
            position: relative; padding-top: 35px; margin-top: 8px;
        }
        .tree-children::before {
            content: ''; position: absolute; top: 8px; left: 50%;
            width: 2px; height: 27px; background: var(--tree-line); transform: translateX(-50%);
        }
        .tree-children > .tree-node::before {
            content: ''; position: absolute; top: -27px; left: 50%;
            width: 2px; height: 27px; background: var(--tree-line); transform: translateX(-50%);
        }
        .tree-children.multi::after {
            content: ''; position: absolute; top: 8px;
            height: 2px; background: var(--tree-line);
            left: calc(50% - var(--w) / 2); width: var(--w);
        }

        /* INFO PANEL */
        .info-panel {
            position: fixed; top: 50%; right: 24px; transform: translateY(-50%);
            width: 340px; background: var(--bg-secondary);
            border-radius: 20px; box-shadow: var(--shadow-xl);
            z-index: 200; display: none; overflow: hidden;
            transition: background-color 0.3s ease;
        }
        .info-panel.active { display: block; animation: slideIn 0.3s ease; }
        @keyframes slideIn { from { opacity: 0; transform: translateY(-50%) translateX(20px); } to { opacity: 1; transform: translateY(-50%) translateX(0); } }
        .info-header {
            padding: 1.75rem; background: var(--accent-gradient);
            color: var(--text-inverse); text-align: center; position: relative;
        }
        .info-close {
            position: absolute; top: 1rem; right: 1rem;
            width: 32px; height: 32px; background: rgba(255,255,255,0.2);
            border: none; border-radius: 50%; color: white;
            cursor: pointer; display: flex; align-items: center; justify-content: center;
            font-size: 1.1rem; transition: background 0.2s;
        }
        .info-close:hover { background: rgba(255,255,255,0.3); }
        .info-avatar {
            width: 72px; height: 72px; border-radius: 50%;
            background: rgba(255,255,255,0.2);
            display: flex; align-items: center; justify-content: center;
            font-size: 2rem; margin: 0 auto 0.75rem;
        }
        .info-name { font-size: 1.2rem; font-weight: 700; }
        .info-alias { font-size: 0.85rem; opacity: 0.85; margin-top: 0.25rem; }
        .info-body { padding: 1.25rem 1.5rem; max-height: 400px; overflow-y: auto; }
        .info-section { margin-bottom: 1rem; }
        .info-section-title { font-size: 0.65rem; font-weight: 600; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 0.5rem; }
        .info-row { display: flex; align-items: center; padding: 0.5rem 0; gap: 0.75rem; }
        .info-row-icon {
            width: 32px; height: 32px; background: var(--bg-tertiary);
            border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 0.9rem;
        }
        .info-row-label { font-size: 0.7rem; color: var(--text-muted); }
        .info-row-value { font-size: 0.875rem; font-weight: 500; color: var(--text-primary); }
        .info-row-value a { color: var(--accent); text-decoration: none; cursor: pointer; }
        .info-row-value a:hover { text-decoration: underline; }
        .info-tags { display: flex; flex-wrap: wrap; gap: 0.4rem; margin-top: 0.5rem; }
        .info-tag {
            padding: 0.35rem 0.65rem; background: var(--bg-tertiary);
            border-radius: 20px; font-size: 0.75rem; font-weight: 500;
            cursor: pointer; transition: all 0.2s ease; color: var(--text-secondary);
        }
        .info-tag:hover { background: var(--accent); color: white; }

        /* RELATIONSHIP */
        .search-form { display: grid; grid-template-columns: 1fr auto 1fr; gap: 1.5rem; align-items: end; }
        .form-group label { display: block; font-size: 0.8rem; font-weight: 500; color: var(--text-secondary); margin-bottom: 0.5rem; }
        .form-select {
            width: 100%; padding: 0.75rem 1rem;
            font-family: inherit; font-size: 0.9rem;
            border: 2px solid var(--border); border-radius: 10px;
            background: var(--bg-secondary); cursor: pointer;
            transition: all 0.2s ease; color: var(--text-primary);
        }
        .form-select:focus { outline: none; border-color: var(--accent); box-shadow: 0 0 0 3px var(--accent-light); }
        .search-connector {
            display: flex; align-items: center; justify-content: center;
            width: 48px; height: 48px; background: var(--bg-tertiary);
            border-radius: 50%; color: var(--text-muted); font-size: 1.25rem; margin-bottom: 0.25rem;
        }
        .search-actions { margin-top: 1.5rem; text-align: center; }

        .result-container { margin-top: 2rem; }
        .result-card {
            background: var(--bg-secondary); border-radius: 16px;
            padding: 2rem; box-shadow: var(--shadow); border: 1px solid var(--border);
        }
        .result-header { text-align: center; padding-bottom: 1.5rem; border-bottom: 1px solid var(--border-light); margin-bottom: 1.5rem; }
        .result-names { font-size: 1rem; color: var(--text-secondary); margin-bottom: 0.75rem; }
        .result-names strong { color: var(--text-primary); }
        .result-badge {
            display: inline-block; padding: 0.65rem 1.5rem;
            background: var(--accent-gradient); color: white;
            border-radius: 30px; font-weight: 600; font-size: 1rem;
            box-shadow: 0 4px 12px rgba(34, 197, 94, 0.3);
        }

        .rel-tree { display: flex; flex-direction: column; align-items: center; padding: 1.5rem 0; }
        .rel-ancestor {
            background: var(--warning-gradient); color: white;
            padding: 1.25rem 2rem; border-radius: 16px; text-align: center;
            box-shadow: 0 8px 20px rgba(245, 158, 11, 0.3);
        }
        .rel-ancestor-icon { font-size: 1.5rem; margin-bottom: 0.25rem; }
        .rel-ancestor-name { font-weight: 700; font-size: 1rem; }
        .rel-ancestor-label { font-size: 0.75rem; opacity: 0.9; margin-top: 0.25rem; }
        .rel-line { width: 2px; height: 40px; background: var(--tree-line); }
        .rel-branches { display: flex; gap: 4rem; position: relative; }
        .rel-branches::before { content: ''; position: absolute; top: 0; left: 50%; transform: translateX(-50%); width: 2px; height: 20px; background: var(--tree-line); }
        .rel-branches::after { content: ''; position: absolute; top: 20px; left: 20%; right: 20%; height: 2px; background: var(--tree-line); }
        .rel-branch { display: flex; flex-direction: column; align-items: center; padding-top: 20px; }
        .rel-branch::before { content: ''; width: 2px; height: 20px; background: var(--tree-line); }
        .rel-person {
            background: var(--bg-secondary); border: 2px solid var(--border);
            border-radius: 12px; padding: 0.875rem 1.25rem; text-align: center;
            box-shadow: var(--shadow); min-width: 130px; margin: 0.5rem 0;
        }
        .rel-person.target { background: var(--accent-light); border-color: var(--accent); }
        .rel-person.male { border-left: 4px solid var(--male); }
        .rel-person.female { border-left: 4px solid var(--female); }
        .rel-person-icon { font-size: 1.5rem; margin-bottom: 0.25rem; }
        .rel-person-name { font-size: 0.85rem; font-weight: 600; color: var(--text-primary); }
        .rel-person-label {
            font-size: 0.65rem; background: var(--text-secondary); color: white;
            padding: 0.2rem 0.5rem; border-radius: 4px; margin-top: 0.35rem; display: inline-block;
        }
        .rel-person.target .rel-person-label { background: var(--accent); }
        .branch-line { width: 2px; height: 16px; background: var(--tree-line); }

        .explanation { background: var(--bg-tertiary); border-radius: 12px; padding: 1.25rem; margin-top: 1.5rem; }
        .explanation-title { font-size: 0.8rem; font-weight: 600; color: var(--text-primary); margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem; }
        .step { display: flex; align-items: flex-start; gap: 0.75rem; padding: 0.5rem 0; }
        .step-num {
            width: 22px; height: 22px; background: var(--accent); color: white;
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            font-size: 0.7rem; font-weight: 600; flex-shrink: 0;
        }
        .step-text { font-size: 0.85rem; color: var(--text-secondary); line-height: 1.5; }
        .step-text strong { color: var(--text-primary); }
        .conclusion {
            margin-top: 1rem; padding: 1rem; background: var(--bg-secondary);
            border-radius: 10px; text-align: center; border: 1px solid var(--border);
        }
        .conclusion-label { font-size: 0.75rem; color: var(--text-muted); margin-bottom: 0.25rem; }
        .conclusion-value { font-size: 1.25rem; font-weight: 700; color: var(--accent); }

        /* DIRECTORY */
        .search-input {
            width: 100%; padding: 0.875rem 1rem 0.875rem 2.75rem;
            font-family: inherit; font-size: 0.9rem;
            border: 2px solid var(--border); border-radius: 12px;
            background: var(--bg-secondary) url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='18' height='18' fill='%2394a3b8' viewBox='0 0 16 16'%3E%3Cpath d='M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z'/%3E%3C/svg%3E") no-repeat 1rem center;
            transition: all 0.2s ease; color: var(--text-primary);
        }
        .search-input:focus { outline: none; border-color: var(--accent); box-shadow: 0 0 0 3px var(--accent-light); }
        .person-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap: 1rem; margin-top: 1.25rem; }
        .person-card {
            background: var(--bg-secondary); border: 1px solid var(--border);
            border-radius: 14px; padding: 1.25rem;
            cursor: pointer; transition: all 0.25s ease;
        }
        .person-card:hover { border-color: var(--accent); box-shadow: var(--shadow-md); transform: translateY(-2px); }
        .person-card-top { display: flex; align-items: center; gap: 0.875rem; }
        .person-card-avatar {
            width: 48px; height: 48px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center; font-size: 1.25rem;
        }
        .person-card-avatar.male { background: var(--male-bg); }
        .person-card-avatar.female { background: var(--female-bg); }
        .person-card-name { font-weight: 600; font-size: 0.95rem; color: var(--text-primary); }
        .person-card-alias { font-size: 0.8rem; color: var(--text-muted); }
        .person-card-info { margin-top: 0.75rem; padding-top: 0.75rem; border-top: 1px solid var(--border-light); font-size: 0.8rem; color: var(--text-secondary); }

        /* STATS */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 1rem; }
        .stat-card {
            background: var(--bg-secondary); border: 1px solid var(--border);
            border-radius: 14px; padding: 1.5rem; text-align: center;
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }
        .stat-icon {
            width: 48px; height: 48px; background: var(--accent-light);
            border-radius: 12px; display: flex; align-items: center; justify-content: center;
            font-size: 1.25rem; margin: 0 auto 0.75rem;
        }
        .stat-value { font-size: 2rem; font-weight: 700; color: var(--text-primary); }
        .stat-label { font-size: 0.8rem; color: var(--text-muted); margin-top: 0.25rem; }

        /* GENERATIONS */
        .gen-section {
            background: var(--bg-secondary); border: 1px solid var(--border);
            border-radius: 14px; margin-bottom: 1rem; overflow: hidden;
        }
        .gen-header {
            padding: 1rem 1.25rem; background: var(--bg-tertiary);
            display: flex; align-items: center; gap: 0.75rem;
            border-bottom: 1px solid var(--border);
        }
        .gen-badge { background: var(--accent); color: white; padding: 0.35rem 0.75rem; border-radius: 6px; font-size: 0.75rem; font-weight: 600; }
        .gen-title { font-weight: 600; color: var(--text-primary); }
        .gen-body { padding: 1rem 1.25rem; }
        .family-group { margin: 0.75rem 0; padding: 1rem; background: var(--bg-tertiary); border-radius: 10px; }
        .parent-name { font-weight: 600; font-size: 0.9rem; color: var(--text-primary); margin-bottom: 0.75rem; }
        .children-tags { display: flex; flex-wrap: wrap; gap: 0.5rem; }
        .child-tag {
            padding: 0.4rem 0.75rem; background: var(--bg-secondary);
            border: 1px solid var(--border); border-radius: 20px;
            font-size: 0.8rem; cursor: pointer; transition: all 0.2s ease; color: var(--text-primary);
        }
        .child-tag:hover { background: var(--accent); color: white; border-color: var(--accent); }
        .child-tag.male { border-left: 3px solid var(--male); }
        .child-tag.female { border-left: 3px solid var(--female); }

        /* MODAL */
        .modal {
            display: none; position: fixed; inset: 0;
            background: var(--modal-overlay); z-index: 1000;
            justify-content: center; align-items: center;
            backdrop-filter: blur(4px);
        }
        .modal.active { display: flex; }
        .modal-content {
            background: var(--bg-secondary); border-radius: 20px;
            width: 90%; max-width: 440px; max-height: 85vh; overflow-y: auto;
            animation: modalIn 0.3s ease;
        }
        @keyframes modalIn { from { opacity: 0; transform: scale(0.95) translateY(10px); } to { opacity: 1; transform: scale(1) translateY(0); } }
        .modal-header {
            padding: 1.5rem; border-bottom: 1px solid var(--border-light);
            display: flex; align-items: center; justify-content: space-between;
        }
        .modal-title { font-size: 1.1rem; font-weight: 600; color: var(--text-primary); }
        .modal-close {
            width: 32px; height: 32px; background: var(--bg-tertiary);
            border: none; border-radius: 8px; cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            color: var(--text-muted); font-size: 1.1rem;
        }
        .modal-close:hover { background: var(--bg-hover); }
        .modal-body { padding: 1.5rem; }

        /* RESPONSIVE */
        @media (max-width: 768px) {
            .sidebar { display: none; }
            .main-content { margin-left: 0; }
            .search-form { grid-template-columns: 1fr; }
            .search-connector { display: none; }
            .info-panel { right: 10px; left: 10px; width: auto; }
            .rel-branches { flex-direction: column; gap: 1rem; }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <aside class="sidebar">
            <div class="logo">
                <div class="logo-main">
                    <div class="logo-icon">üå≥</div>
                    <div>
                        <div class="logo-text">ALY KO√èRA</div>
                        <div class="logo-subtitle">G√©n√©alogie familiale</div>
                    </div>
                </div>
            </div>
            
            <nav class="nav-menu">
                <div class="nav-section-title">Navigation</div>
                <button class="nav-item active" onclick="showSection('tree')">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 3v18M5 10l7-7 7 7"/></svg>
                    Arbre interactif
                </button>
                <button class="nav-item" onclick="showSection('generations')">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/></svg>
                    Par g√©n√©ration
                </button>
                <button class="nav-item" onclick="showSection('relationship')">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87M16 3.13a4 4 0 0 1 0 7.75"/></svg>
                    Lien de parent√©
                </button>
                <button class="nav-item" onclick="showSection('directory')">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
                    Annuaire
                </button>
                
                <div class="nav-section-title" style="margin-top: 1rem;">Donn√©es</div>
                <button class="nav-item" onclick="showSection('stats')">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 20V10M12 20V4M6 20v-6"/></svg>
                    Statistiques
                </button>
                
                <div class="nav-section-title" style="margin-top: 1rem;">Apparence</div>
                <div class="theme-toggle">
                    <button class="theme-btn active" onclick="setTheme('light')" id="light-btn">
                        ‚òÄÔ∏è Clair
                    </button>
                    <button class="theme-btn" onclick="setTheme('dark')" id="dark-btn">
                        üåô Sombre
                    </button>
                </div>
            </nav>
            
            <div class="sidebar-footer">
                <div class="family-badge">
                    <div class="family-avatar">üë®‚Äçüë©‚Äçüëß‚Äçüë¶</div>
                    <div class="family-info">
                        <div class="family-name">Famille Tour√©</div>
                        <div class="family-count" id="total-count">-- membres</div>
                    </div>
                </div>
            </div>
        </aside>

        <main class="main-content">
            <header class="topbar">
                <div>
                    <h1 class="page-title" id="page-title">Arbre interactif</h1>
                    <p class="page-subtitle" id="page-subtitle">Explorez votre histoire familiale</p>
                </div>
            </header>

            <div class="content-area">
                <section id="tree" class="section active">
                    <div class="card">
                        <div class="card-header">
                            <span class="card-title">Visualisation de l'arbre</span>
                            <div class="tree-toolbar">
                                <select id="root-select" class="select-modern" onchange="changeRoot()">
                                    <option value="alkamahamane_sabalkaidi">Alkamahamane Sabalkaidi</option>
                                    <option value="ali_alkamahamane" selected>Ali Alkamahamane (Aly Ko√Øra)</option>
                                    <option value="mahamane_ali">Mahamane Ali</option>
                                    <option value="babachigaw_ali">Babachigaw Ali</option>
                                    <option value="moussa_ali">Moussa Ali</option>
                                    <option value="omorou_ali">Omorou Ali</option>
                                    <option value="tamimoune_ali">Tamimoune Ali</option>
                                    <option value="mahadi_ali">Mahadi Ali</option>
                                </select>
                                <button class="btn btn-sm" onclick="expandAll()">Tout d√©plier</button>
                                <button class="btn btn-sm" onclick="collapseAll()">Replier</button>
                                <div style="display:flex;gap:4px;">
                                    <button class="btn btn-icon btn-sm" onclick="zoom(-0.1)">‚àí</button>
                                    <button class="btn btn-icon btn-sm" onclick="zoom(0.1)">+</button>
                                    <button class="btn btn-icon btn-sm" onclick="resetZoom()">‚Ü∫</button>
                                </div>
                            </div>
                        </div>
                        <div class="tree-canvas">
                            <div class="tree-container" id="tree-container"></div>
                        </div>
                    </div>
                </section>

                <section id="generations" class="section"><div id="gen-content"></div></section>
                <section id="relationship" class="section">
                    <div class="card">
                        <div class="card-header"><span class="card-title">Rechercher un lien de parent√©</span></div>
                        <div class="card-body">
                            <div class="search-form">
                                <div class="form-group"><label>Premi√®re personne</label><select id="person1" class="form-select"><option value="">Choisir...</option></select></div>
                                <div class="search-connector">‚Üî</div>
                                <div class="form-group"><label>Deuxi√®me personne</label><select id="person2" class="form-select"><option value="">Choisir...</option></select></div>
                            </div>
                            <div class="search-actions"><button class="btn btn-primary" onclick="findRelation()">üîç Trouver le lien</button></div>
                            <div id="result"></div>
                        </div>
                    </div>
                </section>
                <section id="directory" class="section">
                    <div class="card">
                        <div class="card-header"><span class="card-title">Annuaire familial</span></div>
                        <div class="card-body">
                            <input type="text" id="search" class="search-input" placeholder="Rechercher un membre..." oninput="filter()">
                            <div class="person-grid" id="person-grid"></div>
                        </div>
                    </div>
                </section>
                <section id="stats" class="section"><div class="stats-grid" id="stats-grid"></div></section>
            </div>
        </main>
    </div>

    <div class="info-panel" id="info-panel">
        <div class="info-header">
            <button class="info-close" onclick="closeInfo()">√ó</button>
            <div class="info-avatar" id="info-avatar">üë§</div>
            <div class="info-name" id="info-name"></div>
            <div class="info-alias" id="info-alias"></div>
        </div>
        <div class="info-body" id="info-body"></div>
    </div>

    <div class="modal" id="modal" onclick="if(event.target===this)closeModal()">
        <div class="modal-content">
            <div class="modal-header">
                <span class="modal-title" id="modal-title"></span>
                <button class="modal-close" onclick="closeModal()">√ó</button>
            </div>
            <div class="modal-body" id="modal-body"></div>
        </div>
    </div>

    <script>
// BASE DE DONN√âES COMPL√àTE - ~100 personnes
const data = {
    // G√âN√âRATION 1
    "alkamahamane_sabalkaidi": { id: "alkamahamane_sabalkaidi", name: "Alkamahamane Sabalkaidi", alias: null, gender: "M", gen: 1, father: null, mother: null, children: ["goussoumbi_alkamahamane", "goma_alkamahamane", "hounaye_alkamahamane", "soumboulou_alkamahamane", "farimata_alkamahamane", "ali_alkamahamane"], note: "Anc√™tre fondateur" },
    "lalla_hamatou": { id: "lalla_hamatou", name: "Lalla Hamatou", alias: "De Seyna", gender: "F", gen: 1, father: null, mother: null, children: [], linkedTo: "alkamahamane_sabalkaidi", note: "√âpouse d'Alkamahamane" },
    
    // G√âN√âRATION 2 - Enfants d'Alkamahamane
    "goussoumbi_alkamahamane": { id: "goussoumbi_alkamahamane", name: "Goussoumbi", alias: null, gender: "M", gen: 2, father: "alkamahamane_sabalkaidi", mother: "lalla_hamatou", children: [] },
    "goma_alkamahamane": { id: "goma_alkamahamane", name: "Goma", alias: null, gender: "M", gen: 2, father: "alkamahamane_sabalkaidi", mother: "lalla_hamatou", children: [] },
    "hounaye_alkamahamane": { id: "hounaye_alkamahamane", name: "Hounaye", alias: null, gender: "F", gen: 2, father: "alkamahamane_sabalkaidi", mother: "lalla_hamatou", children: [] },
    "soumboulou_alkamahamane": { id: "soumboulou_alkamahamane", name: "Soumboulou", alias: null, gender: "F", gen: 2, father: "alkamahamane_sabalkaidi", mother: "lalla_hamatou", children: [] },
    "farimata_alkamahamane": { id: "farimata_alkamahamane", name: "Farimata Alkamahamane", alias: null, gender: "F", gen: 2, father: "alkamahamane_sabalkaidi", mother: "lalla_hamatou", children: ["dalla"] },
    "ali_alkamahamane": { id: "ali_alkamahamane", name: "Ali Alkamahamane", alias: "Aly Ko√Øra", gender: "M", gen: 2, father: "alkamahamane_sabalkaidi", mother: "lalla_hamatou", children: ["mahamane_ali", "babachigaw_ali", "agacha_kobbo", "moussa_ali", "omorou_ali", "tamimoune_ali", "mahadi_ali"], note: "Fondateur du quartier Ali Ko√Øra - 7 enfants" },
    
    // G√âN√âRATION 3 - Enfants d'Ali Alkamahamane
    "mahamane_ali": { id: "mahamane_ali", name: "Mahamane Ali", alias: null, gender: "M", gen: 3, father: "ali_alkamahamane", mother: null, children: ["mohomone_galla", "taya_mahamane", "ahmadou_agawa", "yata_mahamane", "issouf_tabbo", "halilou_mahamane", "alhalil_mahamane", "aliou_mahamane", "houzaye_mahamane", "alassane_sosso", "agaicha_mahamane", "abdou_doudou"], note: "M√®re: Waykounga Samba - 12 enfants" },
    "babachigaw_ali": { id: "babachigaw_ali", name: "Babachigaw Ali", alias: "Babachigo", gender: "M", gen: 3, father: "ali_alkamahamane", mother: null, children: ["aliou_babachigaw", "aboubacar_babachigaw", "ousmane_achidogo", "alhousseini_aggada", "abdoulaye_sagara", "nouhoum_babachigaw", "mata_babachigaw"], note: "M√®re: Farimata Alassane - 7 enfants" },
    "agacha_kobbo": { id: "agacha_kobbo", name: "Agacha Ali", alias: "Kobbo", gender: "F", gen: 3, father: "ali_alkamahamane", mother: null, children: ["aicha_fedja", "arhamatou_fedja", "issa_mohomodou", "taya_mohomodou", "izeboncana_tayda", "jaouja_tayda", "dally_tayda"], note: "M√®re: Fouga Alassane - 7 enfants" },
    "moussa_ali": { id: "moussa_ali", name: "Moussa Ali", alias: null, gender: "M", gen: 3, father: "ali_alkamahamane", mother: null, children: ["mata_moussa", "haylloli_moussa", "wanaissou_moussa", "jato_moussa", "alassane_moussa", "assoumane_moussa", "abdou_moussa", "sala_moussa"], note: "M√®re: Fouga Alassane - 8 enfants" },
    "omorou_ali": { id: "omorou_ali", name: "Omorou Ali", alias: null, gender: "M", gen: 3, father: "ali_alkamahamane", mother: null, children: ["houssouba_omorou", "kabongou_omorou", "mahamadou_omorou", "sourgou_omorou", "tabbo_omorou", "zabbo_omorou", "ichata_omorou"], note: "M√®re: Fouga Alassane - 7 enfants" },
    "tamimoune_ali": { id: "tamimoune_ali", name: "Tamimoune Ali", alias: "Tamimou", gender: "M", gen: 3, father: "ali_alkamahamane", mother: null, children: ["chiddaye_alphary", "mata_alphary", "ichata_alphary", "boudjal_alphary", "saleymatou_alphary"], note: "M√®re: Fouga Alassane - 5 enfants" },
    "mahadi_ali": { id: "mahadi_ali", name: "Mahadi Ali", alias: null, gender: "M", gen: 3, father: "ali_alkamahamane", mother: null, children: ["dayo_mahadi", "saffia_mahadi", "sawde_mahadi", "zarha_mahadi", "aminta_mahadi", "seydou_mahadi"], note: "M√®re: Fouga Alassane - 6 enfants" },
    "dalla": { id: "dalla", name: "Dalla", alias: null, gender: "M", gen: 3, father: "alkamahamane_sabalkaidi", mother: "farimata_alkamahamane", children: [] },
    
    // G√âN√âRATION 4 - Enfants de Mahamane Ali
    "mohomone_galla": { id: "mohomone_galla", name: "Mohomone", alias: "Galla", gender: "M", gen: 4, father: "mahamane_ali", mother: null, children: ["ibrahim_mohomone", "seydou_mohomone", "ousmane_mohomone", "adama_mohomone", "hirinissa_mohomone"], note: "M√®re: Aicha Houneye" },
    "taya_mahamane": { id: "taya_mahamane", name: "Taya Mahamane", alias: null, gender: "M", gen: 4, father: "mahamane_ali", mother: null, children: ["halimatou_hamadahamane", "assaliha_hamadahamane", "arboncana_hamadahamane", "hadaye_hamadahamane"], note: "M√®re: Aicha Houneye" },
    "ahmadou_agawa": { id: "ahmadou_agawa", name: "Ahmadou", alias: "Agawa", gender: "M", gen: 4, father: "mahamane_ali", mother: null, children: [], note: "M√®re: Adijatou Hamma" },
    "yata_mahamane": { id: "yata_mahamane", name: "Yata", alias: null, gender: "F", gen: 4, father: "mahamane_ali", mother: null, children: ["momo_assabi", "adama_assabi", "hounaijata_assabi", "waykouti_assabi", "daoulata_assabi", "mouna_assabi", "zeinaba_assabi"], note: "M√®re: Adijatou Hamma" },
    "issouf_tabbo": { id: "issouf_tabbo", name: "Issouf", alias: "Tabbo", gender: "M", gen: 4, father: "mahamane_ali", mother: null, children: ["moulaye_tabbo", "adijatou_tabbo", "annoussourou_tabbo", "alassane_boncana_tabbo", "arhamatou_tabbo", "assaliha_tabbo", "yahiya_tabbo"], note: "M√®re: Adijatou Hamma" },
    "halilou_mahamane": { id: "halilou_mahamane", name: "Halilou", alias: "Halihou", gender: "M", gen: 4, father: "mahamane_ali", mother: null, children: ["hamma_ario_halilou", "idrissa_halilou", "mariam_halilou", "aichata_halilou"], note: "M√®re: Aicha Hamma" },
    "alhalil_mahamane": { id: "alhalil_mahamane", name: "Alhalil", alias: null, gender: "M", gen: 4, father: "mahamane_ali", mother: null, children: [], note: "M√®re: Aicha Hamma" },
    "aliou_mahamane": { id: "aliou_mahamane", name: "Aliou Mahamane", alias: null, gender: "M", gen: 4, father: "mahamane_ali", mother: null, children: [], note: "M√®re: Aicha Hamma - Sans enfants" },
    "houzaye_mahamane": { id: "houzaye_mahamane", name: "Houzaye", alias: null, gender: "M", gen: 4, father: "mahamane_ali", mother: null, children: [], note: "M√®re: Aicha Hamma" },
    "alassane_sosso": { id: "alassane_sosso", name: "Alassane", alias: "Sosso", gender: "M", gen: 4, father: "mahamane_ali", mother: null, children: ["alhabibou_alassane", "alkassoume_alassane", "ibrahim_alassane", "abdourhamane_alassane", "moussa_alassane", "mariama_alassane", "safietou_alassane", "hamsatou_alassane", "arhamatou_alassane", "hawa_alassane", "bintou_alassane", "aichata_alassane"], note: "M√®re: Aicha Hamma - 12 enfants" },
    "agaicha_mahamane": { id: "agaicha_mahamane", name: "Agaicha", alias: null, gender: "F", gen: 4, father: "mahamane_ali", mother: null, children: [], note: "M√®re: Aicha Hamma" },
    "abdou_doudou": { id: "abdou_doudou", name: "Abdou", alias: "Doudou", gender: "M", gen: 4, father: "mahamane_ali", mother: null, children: ["ichata_doudou", "saley_doudou", "hanchata_doudou", "zaouzata_doudou", "sarata_doudou", "akilou_doudou", "moukaila_doudou", "daouda_doudou", "sadou_doudou", "idrissa_doudou"], note: "M√®re: Aicha Hamma - 10 enfants" },
    
    // G√âN√âRATION 4 - Enfants de Babachigaw Ali
    "aliou_babachigaw": { id: "aliou_babachigaw", name: "Aliou Babachigaw", alias: null, gender: "M", gen: 4, father: "babachigaw_ali", mother: null, children: [] },
    "aboubacar_babachigaw": { id: "aboubacar_babachigaw", name: "Aboubacar", alias: "Djama", gender: "M", gen: 4, father: "babachigaw_ali", mother: null, children: [] },
    "ousmane_achidogo": { id: "ousmane_achidogo", name: "Ousmane", alias: "Achidogo", gender: "M", gen: 4, father: "babachigaw_ali", mother: null, children: ["harouna_achidogo"] },
    "alhousseini_aggada": { id: "alhousseini_aggada", name: "Alhousseini", alias: "Aggada", gender: "M", gen: 4, father: "babachigaw_ali", mother: null, children: ["hakimoune_aggada", "hamida_aggada", "houna_aggada", "zabbo_aggada"] },
    "abdoulaye_sagara": { id: "abdoulaye_sagara", name: "Abdoulaye", alias: "Sagara", gender: "M", gen: 4, father: "babachigaw_ali", mother: null, children: [] },
    "nouhoum_babachigaw": { id: "nouhoum_babachigaw", name: "Nouhoum", alias: null, gender: "M", gen: 4, father: "babachigaw_ali", mother: null, children: ["haoua_nouhou"] },
    "mata_babachigaw": { id: "mata_babachigaw", name: "Mata Babachigaw", alias: null, gender: "F", gen: 4, father: "babachigaw_ali", mother: null, children: [] },
    
    // G√âN√âRATION 4 - Enfants de Moussa Ali
    "mata_moussa": { id: "mata_moussa", name: "Mata Moussa", alias: null, gender: "F", gen: 4, father: "moussa_ali", mother: null, children: [] },
    "haylloli_moussa": { id: "haylloli_moussa", name: "Haylloli", alias: null, gender: "F", gen: 4, father: "moussa_ali", mother: null, children: [] },
    "wanaissou_moussa": { id: "wanaissou_moussa", name: "Wanaissou", alias: null, gender: "M", gen: 4, father: "moussa_ali", mother: null, children: [] },
    "jato_moussa": { id: "jato_moussa", name: "Jato", alias: null, gender: "F", gen: 4, father: "moussa_ali", mother: null, children: [] },
    "alassane_moussa": { id: "alassane_moussa", name: "Alassane Moussa", alias: null, gender: "M", gen: 4, father: "moussa_ali", mother: null, children: [] },
    "assoumane_moussa": { id: "assoumane_moussa", name: "Assoumane", alias: null, gender: "M", gen: 4, father: "moussa_ali", mother: null, children: [] },
    "abdou_moussa": { id: "abdou_moussa", name: "Abdou Moussa", alias: "Boudou", gender: "M", gen: 4, father: "moussa_ali", mother: null, children: [] },
    "sala_moussa": { id: "sala_moussa", name: "Sala", alias: null, gender: "M", gen: 4, father: "moussa_ali", mother: null, children: [] },
    
    // G√âN√âRATION 4 - Enfants d'Omorou Ali
    "houssouba_omorou": { id: "houssouba_omorou", name: "Houssouba", alias: null, gender: "M", gen: 4, father: "omorou_ali", mother: null, children: [], note: "Sans enfants" },
    "kabongou_omorou": { id: "kabongou_omorou", name: "Kabongou", alias: null, gender: "M", gen: 4, father: "omorou_ali", mother: null, children: ["wayo_ngoyba", "aminta_ngoyba", "makiou_ngoyba", "yacouba_ngoyba", "ngolo_ngoyba", "issiaka_ngoyba"] },
    "mahamadou_omorou": { id: "mahamadou_omorou", name: "Mahamadou Omorou", alias: null, gender: "M", gen: 4, father: "omorou_ali", mother: null, children: ["zeinabou_mahamadou", "koddo_mahamadou", "bouba_mahamadou"] },
    "sourgou_omorou": { id: "sourgou_omorou", name: "Sourgou", alias: null, gender: "M", gen: 4, father: "omorou_ali", mother: null, children: ["adija_sourgou", "mariama_sourgou", "fatoumata_sourgou", "ammou_sourgou", "koddo_sourgou", "boubacar_sourgou"] },
    "tabbo_omorou": { id: "tabbo_omorou", name: "Tabbo Omorou", alias: "Abdoulaye", gender: "M", gen: 4, father: "omorou_ali", mother: null, children: ["almahamoudou_tabagore", "minkailou_tabagore", "bacha_tabagore", "moumoumini_tabagore", "gallou_tabagore", "soumma_tabagore", "sadou_tabagore", "abdourhamane_tabagore"] },
    "zabbo_omorou": { id: "zabbo_omorou", name: "Zabbo Omorou", alias: null, gender: "F", gen: 4, father: "omorou_ali", mother: null, children: [] },
    "ichata_omorou": { id: "ichata_omorou", name: "Ichata Omorou", alias: null, gender: "F", gen: 4, father: "omorou_ali", mother: null, children: [] },
    
    // G√âN√âRATION 4 - Enfants de Tamimoune Ali
    "chiddaye_alphary": { id: "chiddaye_alphary", name: "Chiddaye", alias: "Sidey", gender: "M", gen: 4, father: "tamimoune_ali", mother: null, children: [] },
    "mata_alphary": { id: "mata_alphary", name: "Mata Alphary", alias: null, gender: "F", gen: 4, father: "tamimoune_ali", mother: null, children: [] },
    "ichata_alphary": { id: "ichata_alphary", name: "Ichata Alphary", alias: null, gender: "F", gen: 4, father: "tamimoune_ali", mother: null, children: [] },
    "boudjal_alphary": { id: "boudjal_alphary", name: "Boudjal", alias: "Boudia", gender: "M", gen: 4, father: "tamimoune_ali", mother: null, children: [] },
    "saleymatou_alphary": { id: "saleymatou_alphary", name: "Saleymatou", alias: null, gender: "F", gen: 4, father: "tamimoune_ali", mother: null, children: [] },
    
    // G√âN√âRATION 4 - Enfants de Mahadi Ali
    "dayo_mahadi": { id: "dayo_mahadi", name: "Dayo", alias: null, gender: "F", gen: 4, father: "mahadi_ali", mother: null, children: [] },
    "saffia_mahadi": { id: "saffia_mahadi", name: "Saffia", alias: null, gender: "F", gen: 4, father: "mahadi_ali", mother: null, children: [] },
    "sawde_mahadi": { id: "sawde_mahadi", name: "Sawde", alias: null, gender: "F", gen: 4, father: "mahadi_ali", mother: null, children: [] },
    "zarha_mahadi": { id: "zarha_mahadi", name: "Zarha", alias: null, gender: "F", gen: 4, father: "mahadi_ali", mother: null, children: [] },
    "aminta_mahadi": { id: "aminta_mahadi", name: "Aminta Mahadi", alias: null, gender: "F", gen: 4, father: "mahadi_ali", mother: null, children: [] },
    "seydou_mahadi": { id: "seydou_mahadi", name: "Seydou Mahadi", alias: null, gender: "M", gen: 4, father: "mahadi_ali", mother: null, children: ["babeye_seydou", "abaneye_seydou", "adija_seydou", "chidi_seydou", "arhamatou_seydou", "mariama_seydou", "ali_seydou", "bibata_seydou", "abdoulaye_seydou", "saleye_seydou"] },
    
    // G√âN√âRATION 4 - Enfants d'Agacha (Kobbo)
    "aicha_fedja": { id: "aicha_fedja", name: "Aicha Fedja", alias: null, gender: "F", gen: 4, father: null, mother: "agacha_kobbo", children: [] },
    "arhamatou_fedja": { id: "arhamatou_fedja", name: "Arhamatou Fedja", alias: null, gender: "F", gen: 4, father: null, mother: "agacha_kobbo", children: [] },
    "issa_mohomodou": { id: "issa_mohomodou", name: "Issa Mohomodou", alias: null, gender: "M", gen: 4, father: null, mother: "agacha_kobbo", children: [] },
    "taya_mohomodou": { id: "taya_mohomodou", name: "Taya Mohomodou", alias: null, gender: "M", gen: 4, father: null, mother: "agacha_kobbo", children: [] },
    "izeboncana_tayda": { id: "izeboncana_tayda", name: "Izeboncana Tayda", alias: null, gender: "F", gen: 4, father: null, mother: "agacha_kobbo", children: ["timintika_bodowal", "sawata_bodowal", "zarha_bodowal"] },
    "jaouja_tayda": { id: "jaouja_tayda", name: "Jaouja Tayda", alias: null, gender: "F", gen: 4, father: null, mother: "agacha_kobbo", children: [] },
    "dally_tayda": { id: "dally_tayda", name: "Dally Tayda", alias: null, gender: "F", gen: 4, father: null, mother: "agacha_kobbo", children: ["arhamatou_dally", "hancha_dally", "idrissa_dally", "abdoulaye_dally", "mouna_dally", "bouba_dally", "souma_dally", "koddo_dally"] },
    
    // G√âN√âRATION 5 - Enfants de Mohomone (Galla)
    "ibrahim_mohomone": { id: "ibrahim_mohomone", name: "Ibrahim Mohomone", alias: null, gender: "M", gen: 5, father: "mohomone_galla", mother: null, children: [] },
    "seydou_mohomone": { id: "seydou_mohomone", name: "Seydou Mohomone", alias: null, gender: "M", gen: 5, father: "mohomone_galla", mother: null, children: [] },
    "ousmane_mohomone": { id: "ousmane_mohomone", name: "Ousmane Mohomone", alias: null, gender: "M", gen: 5, father: "mohomone_galla", mother: null, children: [] },
    "adama_mohomone": { id: "adama_mohomone", name: "Adama Mohomone", alias: null, gender: "M", gen: 5, father: "mohomone_galla", mother: null, children: [] },
    "hirinissa_mohomone": { id: "hirinissa_mohomone", name: "Hirinissa", alias: "Aichata", gender: "F", gen: 5, father: "mohomone_galla", mother: null, children: [] },
    
    // G√âN√âRATION 5 - Enfants d'Alassane (Sosso)
    "alhabibou_alassane": { id: "alhabibou_alassane", name: "Alhabibou", alias: null, gender: "M", gen: 5, father: "alassane_sosso", mother: null, children: [] },
    "alkassoume_alassane": { id: "alkassoume_alassane", name: "Alkassoume", alias: null, gender: "M", gen: 5, father: "alassane_sosso", mother: null, children: [] },
    "ibrahim_alassane": { id: "ibrahim_alassane", name: "Ibrahim Alassane", alias: null, gender: "M", gen: 5, father: "alassane_sosso", mother: null, children: [] },
    "abdourhamane_alassane": { id: "abdourhamane_alassane", name: "Abdourhamane", alias: null, gender: "M", gen: 5, father: "alassane_sosso", mother: null, children: [] },
    "moussa_alassane": { id: "moussa_alassane", name: "Moussa Alassane", alias: null, gender: "M", gen: 5, father: "alassane_sosso", mother: null, children: [] },
    "mariama_alassane": { id: "mariama_alassane", name: "Mariama Alassane", alias: null, gender: "F", gen: 5, father: "alassane_sosso", mother: null, children: [] },
    "safietou_alassane": { id: "safietou_alassane", name: "Safietou Alassane", alias: null, gender: "F", gen: 5, father: "alassane_sosso", mother: null, children: [] },
    "hamsatou_alassane": { id: "hamsatou_alassane", name: "Hamsatou Alassane", alias: null, gender: "F", gen: 5, father: "alassane_sosso", mother: null, children: [] },
    "arhamatou_alassane": { id: "arhamatou_alassane", name: "Arhamatou Alassane", alias: null, gender: "F", gen: 5, father: "alassane_sosso", mother: null, children: [] },
    "hawa_alassane": { id: "hawa_alassane", name: "Hawa Alassane", alias: null, gender: "F", gen: 5, father: "alassane_sosso", mother: null, children: [] },
    "bintou_alassane": { id: "bintou_alassane", name: "Bintou Alassane", alias: null, gender: "F", gen: 5, father: "alassane_sosso", mother: null, children: [] },
    "aichata_alassane": { id: "aichata_alassane", name: "Aichata Alassane", alias: null, gender: "F", gen: 5, father: "alassane_sosso", mother: null, children: [] },
    
    // G√âN√âRATION 5 - Enfants de Tabbo Omorou (Tabagore)
    "almahamoudou_tabagore": { id: "almahamoudou_tabagore", name: "Almahamoudou", alias: "Illile", gender: "M", gen: 5, father: "tabbo_omorou", mother: "saffia_mahadi", children: [] },
    "minkailou_tabagore": { id: "minkailou_tabagore", name: "Minkailou", alias: "Kila", gender: "M", gen: 5, father: "tabbo_omorou", mother: "saffia_mahadi", children: [] },
    "bacha_tabagore": { id: "bacha_tabagore", name: "Bacha Tabagore", alias: null, gender: "M", gen: 5, father: "tabbo_omorou", mother: "saffia_mahadi", children: [] },
    "moumoumini_tabagore": { id: "moumoumini_tabagore", name: "Moumoumini", alias: "Belleythiero", gender: "M", gen: 5, father: "tabbo_omorou", mother: "saffia_mahadi", children: [] },
    "gallou_tabagore": { id: "gallou_tabagore", name: "Gallou", alias: null, gender: "M", gen: 5, father: "tabbo_omorou", mother: "saffia_mahadi", children: [], note: "Sans enfants" },
    "soumma_tabagore": { id: "soumma_tabagore", name: "Soumma", alias: null, gender: "M", gen: 5, father: "tabbo_omorou", mother: "saffia_mahadi", children: [], note: "Sans enfants" },
    "sadou_tabagore": { id: "sadou_tabagore", name: "Sadou Tabagore", alias: null, gender: "M", gen: 5, father: "tabbo_omorou", mother: "saffia_mahadi", children: [], note: "Sans enfants" },
    "abdourhamane_tabagore": { id: "abdourhamane_tabagore", name: "Abdourhamane Tabagore", alias: null, gender: "M", gen: 5, father: "tabbo_omorou", mother: null, children: [] },
    
    // G√âN√âRATION 5 - Enfants de Kabongou Omorou
    "wayo_ngoyba": { id: "wayo_ngoyba", name: "Wayo", alias: "N'goyba", gender: "M", gen: 5, father: "kabongou_omorou", mother: "jato_moussa", children: [] },
    "aminta_ngoyba": { id: "aminta_ngoyba", name: "Aminta", alias: "N'goyba", gender: "F", gen: 5, father: "kabongou_omorou", mother: "jato_moussa", children: [] },
    "makiou_ngoyba": { id: "makiou_ngoyba", name: "Makiou", alias: "N'goyba", gender: "M", gen: 5, father: "kabongou_omorou", mother: "jato_moussa", children: [] },
    "yacouba_ngoyba": { id: "yacouba_ngoyba", name: "Yacouba", alias: "N'goyba", gender: "M", gen: 5, father: "kabongou_omorou", mother: "jato_moussa", children: [] },
    "ngolo_ngoyba": { id: "ngolo_ngoyba", name: "N'Golo", alias: "N'goyba", gender: "M", gen: 5, father: "kabongou_omorou", mother: "jato_moussa", children: [] },
    "issiaka_ngoyba": { id: "issiaka_ngoyba", name: "Issiaka", alias: "N'goyba", gender: "M", gen: 5, father: "kabongou_omorou", mother: null, children: [] },
    
    // G√âN√âRATION 5 - Enfants d'Alhousseini (Aggada)
    "hakimoune_aggada": { id: "hakimoune_aggada", name: "Hakimoune", alias: null, gender: "M", gen: 5, father: "alhousseini_aggada", mother: "mata_alphary", children: [] },
    "hamida_aggada": { id: "hamida_aggada", name: "Hamida", alias: null, gender: "F", gen: 5, father: "alhousseini_aggada", mother: "mata_alphary", children: [] },
    "houna_aggada": { id: "houna_aggada", name: "Houna", alias: null, gender: "F", gen: 5, father: "alhousseini_aggada", mother: "mata_alphary", children: [] },
    "zabbo_aggada": { id: "zabbo_aggada", name: "Zabbo Aggada", alias: null, gender: "F", gen: 5, father: "alhousseini_aggada", mother: "mata_alphary", children: [] },
    
    // G√âN√âRATION 5 - Autres
    "harouna_achidogo": { id: "harouna_achidogo", name: "Harouna", alias: null, gender: "M", gen: 5, father: "ousmane_achidogo", mother: null, children: [] },
    "haoua_nouhou": { id: "haoua_nouhou", name: "Haoua Nouhou", alias: null, gender: "F", gen: 5, father: "nouhoum_babachigaw", mother: null, children: [] },
    
    // G√âN√âRATION 5 - Enfants de Seydou Mahadi
    "babeye_seydou": { id: "babeye_seydou", name: "Babeye", alias: null, gender: "M", gen: 5, father: "seydou_mahadi", mother: null, children: [] },
    "abaneye_seydou": { id: "abaneye_seydou", name: "Abaneye", alias: null, gender: "M", gen: 5, father: "seydou_mahadi", mother: null, children: [] },
    "adija_seydou": { id: "adija_seydou", name: "Adija Seydou", alias: null, gender: "F", gen: 5, father: "seydou_mahadi", mother: null, children: [] },
    "chidi_seydou": { id: "chidi_seydou", name: "Chidi", alias: null, gender: "M", gen: 5, father: "seydou_mahadi", mother: null, children: [] },
    "arhamatou_seydou": { id: "arhamatou_seydou", name: "Arhamatou Seydou", alias: null, gender: "F", gen: 5, father: "seydou_mahadi", mother: null, children: [] },
    "mariama_seydou": { id: "mariama_seydou", name: "Mariama Seydou", alias: null, gender: "F", gen: 5, father: "seydou_mahadi", mother: null, children: [] },
    "ali_seydou": { id: "ali_seydou", name: "Ali Seydou", alias: null, gender: "M", gen: 5, father: "seydou_mahadi", mother: null, children: [] },
    "bibata_seydou": { id: "bibata_seydou", name: "Bibata", alias: null, gender: "F", gen: 5, father: "seydou_mahadi", mother: null, children: [] },
    "abdoulaye_seydou": { id: "abdoulaye_seydou", name: "Abdoulaye Seydou", alias: null, gender: "M", gen: 5, father: "seydou_mahadi", mother: null, children: [] },
    "saleye_seydou": { id: "saleye_seydou", name: "Saleye", alias: null, gender: "M", gen: 5, father: "seydou_mahadi", mother: null, children: [] }
};

// THEME MANAGEMENT
function setTheme(theme) {
    document.documentElement.setAttribute('data-theme', theme);
    localStorage.setItem('theme', theme);
    document.getElementById('light-btn').classList.toggle('active', theme === 'light');
    document.getElementById('dark-btn').classList.toggle('active', theme === 'dark');
}

// Load saved theme
const savedTheme = localStorage.getItem('theme') || 'light';
setTheme(savedTheme);

let zoomLevel = 1, expanded = new Set(), selected = null, root = 'ali_alkamahamane';
const titles = { tree: ['Arbre interactif', 'Explorez votre histoire familiale'], generations: ['Par g√©n√©ration', 'Organisation hi√©rarchique'], relationship: ['Lien de parent√©', 'D√©couvrez vos liens familiaux'], directory: ['Annuaire', 'Tous les membres de la famille'], stats: ['Statistiques', 'Donn√©es sur votre famille'] };

function showSection(id) {
    document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
    document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    event.target.closest('.nav-item').classList.add('active');
    document.getElementById('page-title').textContent = titles[id][0];
    document.getElementById('page-subtitle').textContent = titles[id][1];
    if (id === 'tree') renderTree();
    if (id === 'generations') renderGens();
}

function changeRoot() { root = document.getElementById('root-select').value; expanded.clear(); expanded.add(root); selected = null; closeInfo(); renderTree(); }
function renderTree() { document.getElementById('tree-container').innerHTML = buildNode(root, true); }

function buildNode(id, isRoot = false) {
    const p = data[id]; if (!p) return '';
    const isExp = expanded.has(id);
    const kids = (p.children || []).filter(c => data[c]);
    const hasKids = kids.length > 0;
    let h = `<div class="tree-node"><div class="node-card ${p.gender === 'M' ? 'male' : 'female'} ${isRoot ? 'root' : ''} ${selected === id ? 'selected' : ''}" onclick="select('${id}')"><div class="node-avatar">${p.gender === 'M' ? 'üë®' : 'üë©'}</div><div class="node-name">${p.name.split(' ').slice(0, 2).join(' ')}</div>${p.alias ? `<div class="node-alias">${p.alias}</div>` : ''}${hasKids ? `<span class="node-badge">${kids.length}</span>` : ''}${hasKids ? `<button class="node-toggle" onclick="event.stopPropagation();toggle('${id}')">${isExp ? '‚àí' : '+'}</button>` : ''}</div>`;
    if (hasKids && isExp) { h += `<div class="tree-children ${kids.length > 1 ? 'multi' : ''}" style="--w:${Math.max(0, (kids.length - 1) * 142)}px">${kids.map(c => buildNode(c)).join('')}</div>`; }
    return h + '</div>';
}

function toggle(id) { expanded.has(id) ? expanded.delete(id) : expanded.add(id); renderTree(); }
function select(id) { selected = id; renderTree(); showInfo(id); }

function showInfo(id) {
    const p = data[id]; if (!p) return;
    document.getElementById('info-avatar').textContent = p.gender === 'M' ? 'üë®' : 'üë©';
    document.getElementById('info-name').textContent = p.name;
    document.getElementById('info-alias').textContent = p.alias ? `"${p.alias}"` : '';
    let h = '<div class="info-section"><div class="info-section-title">Informations</div>';
    h += `<div class="info-row"><div class="info-row-icon">üìç</div><div class="info-row-content"><div class="info-row-label">G√©n√©ration</div><div class="info-row-value">${p.gen}</div></div></div>`;
    if (p.father && data[p.father]) h += `<div class="info-row"><div class="info-row-icon">üë®</div><div class="info-row-content"><div class="info-row-label">P√®re</div><div class="info-row-value"><a onclick="navTo('${p.father}')">${data[p.father].name}</a></div></div></div>`;
    if (p.mother && data[p.mother]) h += `<div class="info-row"><div class="info-row-icon">üë©</div><div class="info-row-content"><div class="info-row-label">M√®re</div><div class="info-row-value"><a onclick="navTo('${p.mother}')">${data[p.mother].name}</a></div></div></div>`;
    h += '</div>';
    if (p.children?.length) { const kids = p.children.filter(c => data[c]); if (kids.length) h += `<div class="info-section"><div class="info-section-title">Enfants (${kids.length})</div><div class="info-tags">${kids.map(c => `<span class="info-tag" onclick="navTo('${c}')">${data[c].name.split(' ')[0]}</span>`).join('')}</div></div>`; }
    if (p.note) h += `<div class="info-section"><div class="info-section-title">Note</div><p style="font-size:0.85rem;color:var(--text-secondary)">${p.note}</p></div>`;
    document.getElementById('info-body').innerHTML = h;
    document.getElementById('info-panel').classList.add('active');
}

function navTo(id) { let c = id; const exp = [id]; while (c) { const p = data[c]; if (p?.father && data[p.father]) { exp.push(p.father); c = p.father; } else if (p?.mother && data[p.mother]) { exp.push(p.mother); c = p.mother; } else c = null; } exp.forEach(n => expanded.add(n)); select(id); }
function closeInfo() { document.getElementById('info-panel').classList.remove('active'); selected = null; renderTree(); }
function expandAll() { Object.keys(data).forEach(id => { if (data[id].children?.filter(c => data[c]).length) expanded.add(id); }); renderTree(); }
function collapseAll() { expanded.clear(); expanded.add(root); renderTree(); }
function zoom(d) { zoomLevel = Math.max(0.4, Math.min(1.5, zoomLevel + d)); document.getElementById('tree-container').style.transform = `scale(${zoomLevel})`; }
function resetZoom() { zoomLevel = 1; document.getElementById('tree-container').style.transform = 'scale(1)'; }

// RELATION
function getPaths(id, visited = new Set()) {
    const paths = [], p = data[id];
    if (!p || visited.has(id)) return [[p]];
    visited.add(id);
    if (p.father && data[p.father]) getPaths(p.father, new Set(visited)).forEach(x => paths.push([p, ...x]));
    if (p.mother && data[p.mother]) getPaths(p.mother, new Set(visited)).forEach(x => paths.push([p, ...x]));
    if (p.linkedTo && data[p.linkedTo]) getPaths(p.linkedTo, new Set(visited)).forEach(x => paths.push([p, ...x]));
    if (!paths.length) paths.push([p]);
    return paths;
}

function findAncestor(id1, id2) {
    const p1 = getPaths(id1), p2 = getPaths(id2);
    let best = null, min = Infinity;
    for (const a of p1) for (const b of p2) for (let i = 0; i < a.length; i++) { const j = b.findIndex(x => x.id === a[i].id); if (j !== -1 && i + j < min) { min = i + j; best = { ancestor: a[i], path1: a.slice(0, i + 1), path2: b.slice(0, j + 1), d1: i, d2: j }; break; } }
    return best;
}

function getRelType(d1, d2, p1, p2) {
    if (d1 === 0 && d2 === 0) return "M√™me personne";
    if (d1 === 1 && d2 === 1) return p1.gender === p2.gender ? (p1.gender === 'M' ? "Fr√®res" : "S≈ìurs") : "Fr√®re et s≈ìur";
    if (d1 === 0) return d2 === 1 ? (p1.gender === 'M' ? "P√®re" : "M√®re") : d2 === 2 ? (p1.gender === 'M' ? "Grand-p√®re" : "Grand-m√®re") : "Anc√™tre";
    if (d2 === 0) return d1 === 1 ? (p1.gender === 'M' ? "Fils" : "Fille") : d1 === 2 ? (p1.gender === 'M' ? "Petit-fils" : "Petite-fille") : "Descendant";
    if ((d1 === 1 && d2 === 2) || (d1 === 2 && d2 === 1)) return d1 === 1 ? (p1.gender === 'M' ? "Oncle" : "Tante") : (p1.gender === 'M' ? "Neveu" : "Ni√®ce");
    if (d1 === 2 && d2 === 2) return "Cousins germains";
    if (d1 === 3 && d2 === 3) return "Cousins issus de germains";
    const deg = Math.min(d1, d2) - 1, diff = Math.abs(d1 - d2);
    return `Cousins ${deg === 1 ? "germains" : deg + "e degr√©"}${diff ? ` (${diff}√ó √©loign√©s)` : ""}`;
}

function findRelation() {
    const id1 = document.getElementById('person1').value, id2 = document.getElementById('person2').value;
    const cont = document.getElementById('result');
    if (!id1 || !id2) { cont.innerHTML = '<div class="result-container"><div class="result-card" style="text-align:center;color:var(--text-muted);padding:2rem">S√©lectionnez deux personnes</div></div>'; return; }
    if (id1 === id2) { cont.innerHTML = '<div class="result-container"><div class="result-card" style="text-align:center;color:var(--text-muted);padding:2rem">M√™me personne !</div></div>'; return; }
    const p1 = data[id1], p2 = data[id2], r = findAncestor(id1, id2);
    if (!r) { cont.innerHTML = '<div class="result-container"><div class="result-card" style="text-align:center;color:var(--text-muted);padding:2rem">Lien non trouv√©</div></div>'; return; }
    const rel = getRelType(r.d1, r.d2, p1, p2);
    const b1 = r.path1.slice(0, -1).reverse(), b2 = r.path2.slice(0, -1).reverse();
    let h = `<div class="result-container"><div class="result-card"><div class="result-header"><div class="result-names"><strong>${p1.name}</strong> et <strong>${p2.name}</strong></div><span class="result-badge">${rel}</span></div><div class="rel-tree"><div class="rel-ancestor"><div class="rel-ancestor-icon">‚≠ê</div><div class="rel-ancestor-name">${r.ancestor.name}</div><div class="rel-ancestor-label">Anc√™tre commun</div></div><div class="rel-line"></div><div class="rel-branches">`;
    h += `<div class="rel-branch">${b1.map((p, i) => `${i > 0 ? '<div class="branch-line"></div>' : ''}<div class="rel-person ${p.gender === 'M' ? 'male' : 'female'} ${p.id === p1.id ? 'target' : ''}"><div class="rel-person-icon">${p.gender === 'M' ? 'üë®' : 'üë©'}</div><div class="rel-person-name">${p.name.split(' ').slice(0, 2).join(' ')}</div><div class="rel-person-label">${p.id === p1.id ? '‚Üê ' + p1.name.split(' ')[0] : (p.gender === 'M' ? 'Fils' : 'Fille')}</div></div>`).join('') || '<div style="color:var(--text-muted);font-size:0.8rem;padding:1rem">Direct</div>'}</div>`;
    h += `<div class="rel-branch">${b2.map((p, i) => `${i > 0 ? '<div class="branch-line"></div>' : ''}<div class="rel-person ${p.gender === 'M' ? 'male' : 'female'} ${p.id === p2.id ? 'target' : ''}"><div class="rel-person-icon">${p.gender === 'M' ? 'üë®' : 'üë©'}</div><div class="rel-person-name">${p.name.split(' ').slice(0, 2).join(' ')}</div><div class="rel-person-label">${p.id === p2.id ? p2.name.split(' ')[0] + ' ‚Üí' : (p.gender === 'M' ? 'Fils' : 'Fille')}</div></div>`).join('') || '<div style="color:var(--text-muted);font-size:0.8rem;padding:1rem">Direct</div>'}</div>`;
    h += '</div></div><div class="explanation"><div class="explanation-title">üìñ Explication</div>';
    let s = 1;
    for (let i = 0; i < r.path1.length - 1; i++) h += `<div class="step"><span class="step-num">${s++}</span><span class="step-text"><strong>${r.path1[i].name}</strong> est ${r.path1[i].gender === 'M' ? 'le fils' : 'la fille'} de <strong>${r.path1[i + 1].name}</strong></span></div>`;
    for (let i = 0; i < r.path2.length - 1; i++) h += `<div class="step"><span class="step-num">${s++}</span><span class="step-text"><strong>${r.path2[i].name}</strong> est ${r.path2[i].gender === 'M' ? 'le fils' : 'la fille'} de <strong>${r.path2[i + 1].name}</strong></span></div>`;
    h += `<div class="conclusion"><div class="conclusion-label">Donc ils sont</div><div class="conclusion-value">${rel}</div></div></div></div></div>`;
    cont.innerHTML = h;
}

// GENERATIONS
function renderGens() {
    const gens = {}; Object.values(data).forEach(p => { if (!gens[p.gen]) gens[p.gen] = []; gens[p.gen].push(p); });
    let h = '';
    for (let g = 1; g <= 6; g++) { if (!gens[g]) continue;
        h += `<div class="gen-section"><div class="gen-header"><span class="gen-badge">G${g}</span><span class="gen-title">G√©n√©ration ${g}</span></div><div class="gen-body">`;
        const byP = {}; gens[g].forEach(p => { const k = p.father || p.mother || 'root'; if (!byP[k]) byP[k] = []; byP[k].push(p); });
        Object.entries(byP).forEach(([pid, kids]) => { const parent = data[pid]; h += '<div class="family-group">'; if (parent) h += `<div class="parent-name">Enfants de ${parent.name}</div>`; h += `<div class="children-tags">${kids.map(c => `<span class="child-tag ${c.gender === 'M' ? 'male' : 'female'}" onclick="showModal('${c.id}')">${c.name}${c.alias ? ` (${c.alias})` : ''}</span>`).join('')}</div></div>`; });
        h += '</div></div>';
    }
    document.getElementById('gen-content').innerHTML = h;
}

// DIRECTORY
function renderDir() {
    const sorted = Object.values(data).sort((a, b) => a.name.localeCompare(b.name, 'fr'));
    document.getElementById('person-grid').innerHTML = sorted.map(p => `<div class="person-card" onclick="showModal('${p.id}')"><div class="person-card-top"><div class="person-card-avatar ${p.gender === 'M' ? 'male' : 'female'}">${p.gender === 'M' ? 'üë®' : 'üë©'}</div><div><div class="person-card-name">${p.name}</div>${p.alias ? `<div class="person-card-alias">"${p.alias}"</div>` : ''}</div></div><div class="person-card-info">G√©n√©ration ${p.gen}${p.father && data[p.father] ? ` ¬∑ Fils de ${data[p.father].name.split(' ')[0]}` : ''}</div></div>`).join('');
}

function filter() { const q = document.getElementById('search').value.toLowerCase(); document.querySelectorAll('.person-card').forEach(c => { c.style.display = c.textContent.toLowerCase().includes(q) ? '' : 'none'; }); }

// MODAL
function showModal(id) {
    const p = data[id]; if (!p) return;
    document.getElementById('modal-title').textContent = p.name;
    let h = `<div style="text-align:center;margin-bottom:1.5rem"><div style="width:72px;height:72px;border-radius:50%;background:${p.gender === 'M' ? 'var(--male-bg)' : 'var(--female-bg)'};display:inline-flex;align-items:center;justify-content:center;font-size:2rem">${p.gender === 'M' ? 'üë®' : 'üë©'}</div></div>`;
    if (p.alias) h += `<p style="text-align:center;color:var(--text-muted);margin-bottom:1.5rem">"${p.alias}"</p>`;
    h += `<p style="margin:0.5rem 0"><strong>G√©n√©ration:</strong> ${p.gen}</p>`;
    if (p.father && data[p.father]) h += `<p style="margin:0.5rem 0"><strong>P√®re:</strong> ${data[p.father].name}</p>`;
    if (p.mother && data[p.mother]) h += `<p style="margin:0.5rem 0"><strong>M√®re:</strong> ${data[p.mother].name}</p>`;
    if (p.children?.length) { const kids = p.children.filter(c => data[c]); if (kids.length) h += `<p style="margin:0.5rem 0"><strong>Enfants:</strong> ${kids.map(c => data[c].name).join(', ')}</p>`; }
    if (p.note) h += `<p style="margin:0.5rem 0"><strong>Note:</strong> ${p.note}</p>`;
    document.getElementById('modal-body').innerHTML = h;
    document.getElementById('modal').classList.add('active');
}

function closeModal() { document.getElementById('modal').classList.remove('active'); }

// STATS
function renderStats() {
    const ps = Object.values(data);
    document.getElementById('stats-grid').innerHTML = `
        <div class="stat-card"><div class="stat-icon">üë•</div><div class="stat-value">${ps.length}</div><div class="stat-label">Membres</div></div>
        <div class="stat-card"><div class="stat-icon">üë®</div><div class="stat-value">${ps.filter(p => p.gender === 'M').length}</div><div class="stat-label">Hommes</div></div>
        <div class="stat-card"><div class="stat-icon">üë©</div><div class="stat-value">${ps.filter(p => p.gender === 'F').length}</div><div class="stat-label">Femmes</div></div>
        <div class="stat-card"><div class="stat-icon">üå≥</div><div class="stat-value">${new Set(ps.map(p => p.gen)).size}</div><div class="stat-label">G√©n√©rations</div></div>
        <div class="stat-card"><div class="stat-icon">üë®‚Äçüëß</div><div class="stat-value">${ps.filter(p => p.children?.filter(c => data[c]).length).length}</div><div class="stat-label">Avec enfants</div></div>
    `;
    document.getElementById('total-count').textContent = ps.length + ' membres';
}

function populateSelects() {
    const sorted = Object.values(data).sort((a, b) => a.name.localeCompare(b.name, 'fr'));
    ['person1', 'person2'].forEach(id => { const sel = document.getElementById(id); sorted.forEach(p => { const o = document.createElement('option'); o.value = p.id; o.textContent = p.name + (p.alias ? ` (${p.alias})` : ''); sel.appendChild(o); }); });
}

document.addEventListener('DOMContentLoaded', () => {
    expanded.add(root);
    renderTree();
    renderDir();
    renderStats();
    populateSelects();
});
    </script>
</body>
</html>
